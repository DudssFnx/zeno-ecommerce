Este projeto j√° est√° funcionando como um sistema B2B multiempresa com PostgreSQL e Drizzle.
Existem empresas (companies), usu√°rios (b2b_users) e v√≠nculos (user_companies).
O sistema est√° est√°vel e N√ÉO deve ser refatorado.

Objetivo exclusivo deste pedido:
Criar suporte a um usu√°rio SUPER_ADMIN para gest√£o do sistema (empresas, usu√°rios e pedidos),
garantindo que apenas os donos do sistema tenham esse acesso.

‚ö†Ô∏è REGRAS ABSOLUTAS

N√ÉO alterar o comportamento de login dos usu√°rios clientes

N√ÉO modificar schemas existentes sem extrema necessidade

N√ÉO vincular SUPER_ADMIN a nenhuma empresa

N√ÉO permitir que clientes se tornem SUPER_ADMIN

Fazer a menor altera√ß√£o poss√≠vel no c√≥digo

O SUPER_ADMIN deve ser tratado como ‚Äúusu√°rio do sistema‚Äù, n√£o como cliente.

üéØ ETAPA 1 ‚Äî Identifica√ß√£o do SUPER_ADMIN

Implementar a l√≥gica de SUPER_ADMIN usando UMA das op√ß√µes abaixo (preferencialmente ambas):

Op√ß√£o principal (obrigat√≥ria):

Campo l√≥gico isSuperAdmin resolvido no backend

Determinado por:

user.role === 'SUPER_ADMIN' OU

email presente em uma vari√°vel de ambiente segura

Criar vari√°vel de ambiente:

SUPER_ADMIN_EMAILS=admin@sistema.com,owner@sistema.com


Durante o login:

Se o email do usu√°rio estiver nessa lista ‚Üí isSuperAdmin = true

Caso contr√°rio ‚Üí isSuperAdmin = false

üéØ ETAPA 2 ‚Äî Cria√ß√£o do usu√°rio SUPER_ADMIN

Criar apenas UM usu√°rio inicial, manualmente, com as seguintes regras:

Inserido na tabela b2b_users

Email pertencente √† lista SUPER_ADMIN_EMAILS

Senha hash segura

Status ativo

N√ÉO criar nenhum registro em user_companies

Esse usu√°rio:

N√£o pertence a nenhuma empresa

N√£o cria pedidos

N√£o acessa cat√°logo de clientes

üéØ ETAPA 3 ‚Äî Middleware de prote√ß√£o

Criar (ou ajustar) um middleware que:

Bloqueia qualquer rota /admin se isSuperAdmin !== true

Garante que usu√°rios normais:

Mesmo com is_admin = true

Mesmo sendo ADMIN da empresa
NUNCA tenham acesso ao painel global

Exemplo conceitual:

if (!ctx.isSuperAdmin) {
  return res.status(403).json({ message: "Acesso restrito" });
}

üéØ ETAPA 4 ‚Äî Separa√ß√£o clara de escopos

Garantir no backend que:

SUPER_ADMIN:

Pode acessar TODAS as empresas

N√£o usa company_id

Usu√°rio cliente:

Sempre exige company_id

Nunca acessa dados globais

Essa separa√ß√£o deve ser expl√≠cita e segura.

üéØ ETAPA 5 ‚Äî N√ÉO FAZER

‚ö†Ô∏è Explicitamente proibido:

Criar SUPER_ADMIN via cadastro p√∫blico

Expor flag de admin no frontend

Usar is_admin da empresa como crit√©rio de SUPER_ADMIN

Permitir escalonamento de privil√©gio

üìå RESULTADO ESPERADO

Ao final:

Existe exatamente 1 (ou poucos) usu√°rios SUPER_ADMIN

Apenas donos do sistema conseguem acessar /admin

Clientes jamais conseguem acessar painel global

O restante do sistema continua funcionando igual